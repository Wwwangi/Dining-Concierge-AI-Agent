# Chatbot Concierge

## About

A Dining Recommendation Chatbot deployed using AWS

Website Url: http://diningagent.s3-website-us-east-1.amazonaws.com/

## Contributers

Wanqi Wu (ww2578), Chi Wu (cw3326)

## Architecutre

![architecure](/pictures/architecture.png)

1. User -> Frontend (chat.html / AWS S3): user input "hello" to initiate the conversation
2. Frontend -> API: send user's messages to API
3. API -> LF0: LF0 receive message from API
4. LF0 -> Lex: direct user's message to Lex and start the conversation with the Dining Chatbot
5. Lex -> LF1: after the conversation, LF1 will be triggered to send the user preference to SQS
6. CloudWatch triggers LF2 every minute to poll the potential user requests from SQS
7. LF2 makes recommendations based on the user prefernce and send the restaurant info to users via SNS

## Description

### 1) S3

* Store the frontend files
* Store SDK (apigClient.js) generated by AWS API Gateway

### 2) API Gateway

* Create a new API by importing swagger API
* Set POST method and integrate Lambda function LF0 with it
* Set OPTIONS method and its **Method Response** with HTTP status 200
* [Enable CORS](https://docs.aws.amazon.com/apigateway/latest/developerguide/how-to-cors-console.html)
* Deploy API
* Generate SDK for frontend

### 3) Lamba (LF0)

* Receive messages from the frontend user via API Gateway.
* Direct messages to Dining Chatbot in Lex.

### 4) Lex
* Create a Dining Chatbot with three intents:
    * GreetingIntent
    * DiningSuggestionsIntent
    * ThankYouIntent
* Set up user utterances and slots in each intents for interaction conversation
* Integrate with Lambda function (LF1)
* Publish the chatbot

### 5) Lambda (LF1)
Being triggerred when reaching the Lex **DiningSuggestionsIntent** fulfillment and send the user preference to SQS for later processing

### 6) Simple Queue Servive
FIFO type

### 7) ElasticSearch
* 7000+ Yelp API cuisines data.
* Store RestaurantID and cuisine types.

### 8) DynamoDB
* 7000+ Yelp API cuisines data.
* Key: RestaurantID and insertedAtTimestamp.
* Data columns: Business ID, Name, Address, Coordinates, Number of Reviews, Rating, Zip Code, and Phone number.

### 9) Lambda (LF2)
Take requests from SQS.
Retrieve key message and get key id by elasticsearch.
Use key as an index to load data from dynamodB.
Randomly select recommended restaurants.
Organize the data into a message and deliver it to users by both e-mail and phone.

### 10) CloudWatch
Trigger LF2 every one minute
